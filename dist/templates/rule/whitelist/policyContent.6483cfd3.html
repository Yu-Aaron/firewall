<div class="modal-header">
  <h3 class="modal-header-title">预览规则</h3>
  <a id="rule-whiteList-editor_a_previewCancel" class="modal-close" ng-click="cancel()"><i class="fa fa-times"></i></a>
</div>

<div class="modal-body">
  <h4 ng-if="policyBlocks.type!='SIGNATURE'" class="modal-title spacing-small"><i class="fa fa-cogs icon-left"></i>规则信息
  </h4>
  <h4 ng-if="policyBlocks.type=='SIGNATURE'" class="modal-title spacing-small"><i class="fa fa-cogs icon-left"></i>漏洞信息
  </h4>

  <div id="whitelist_policycontent_preview_window_info" ng-if="policyBlocks.type=='SIGNATURE'"
       class="bg-gray-80 margin-top-default">
    <div class="rules-info">
      <div class="row">
        <div class="col-xs-6">
          <div class="row">
            <div class="col-xs-12">
              <div class="rules-info-item">
                <h6 class="rules-info-item-title">漏洞名称</h6>
                <span>{{policyBlocks.name}}</span>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-xs-12">
              <div class="rules-info-item border-gray-top">
                <h6 class="rules-info-item-title">基本描述</h6>
                <span class="textarea-full-width">{{policyBlocks['_description']}}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xs-4 border-gray-left border-gray-right">
          <div class="row">
            <div class="col-xs-4">
              <div class="rules-info-item pull-left">
                <h6 class="rules-info-item-title">漏洞统一编号</h6>
                <span>{{policyBlocks['_cve']}}</span></span>
              </div>

              <div class="rules-info-item pull-left">
                <h6 class="rules-info-item-title">攻击条件</h6>
                <span>{{policyBlocks['_requirement']}}</span>
              </div>

              <div class="rules-info-item pull-left">
                <h6 class="rules-info-item-title">产生后果</h6>
                <span>{{policyBlocks['_caused']}}</span>
              </div>
            </div>

            <div class="col-xs-4">
              <div id="whitelist_policycontent_preview_window_discoverdate" class="rules-info-item pull-left">
                <h6 class="rules-info-item-title">发现时间</h6>
                <span>{{policyBlocks['_publishDate']}}</span>
              </div>

              <div class="rules-info-item pull-left">
                <h6 class="rules-info-item-title">漏洞来源</h6>
                <span>iSightPartners</span>
              </div>

              <div class="rules-info-item pull-left">
                <h6 class="rules-info-item-title">危害等级</h6>
                <span>{{policyBlocks['_severity']}}</span>
              </div>
            </div>

            <div class="col-xs-4">
              <div class="rules-info-item pull-left">
                <h6 class="rules-info-item-title">漏洞类型</h6>
                <span>{{policyBlocks['_category']}}</span>
              </div>

              <div class="rules-info-item pull-left">
                <h6 class="rules-info-item-title">受影响厂商</h6>
                <span>Iconics</span>
              </div>

              <div class="rules-info-item pull-left">
                <h6 class="rules-info-item-title">触发设备</h6>
                <span>Genesis</span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xs-2">
          <div id="whitelist_policycontent_preview_window_rulesource" class="rules-info-item">
            <h6 class="rules-info-item-title">规则来源</h6>
            <span>漏洞库</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div ng-if="policyBlocks.type!='SIGNATURE'" class="bg-gray-80">
    <div class="rules-info">
      <div class="row">
        <div class="col-xs-8">
          <div class="row">
            <div class="col-xs-4">
              <div class="rules-info-item">
                <h6 class="rules-info-item-title">规则组名称</h6>
                <span>{{policyBlocks.name}}</span>
              </div>
            </div>
            <div class="col-xs-4">
              <div class="rules-info-item">
                <h6 class="rules-info-item-title">起源组</h6>
                <span>{{policyBlocks['_sourceZoneName']}}</span>
              </div>
            </div>
            <div class="col-xs-4">
              <div class="rules-info-item">
                <h6 class="rules-info-item-title">目标组</h6>
                <span>{{policyBlocks['_destinationZoneName']}}</span>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-xs-4">
              <div class="rules-info-item">
                <h6 class="rules-info-item-title">规则描述</h6>
                <span ng-if="policyBlocks.description">{{policyBlocks.description}}</span>
                <span ng-if="!policyBlocks.description">无</span>
              </div>
            </div>
            <div class="col-xs-4">
              <div class="rules-info-item">
                <h6 class="rules-info-item-title">vlanId</h6>
                <span>{{policyBlocks['vlanId']}}</span>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xs-4">
          <div id="whitelist_policycontent_preview_window_createdate" class="rules-info-item">
            <h6 class="rules-info-item-title">创建时间</h6>
            <span>{{policyBlocks.createdAt | date: 'yyyy-MM-dd HH:mm:ss'}}</span>
          </div>
          <div class="rules-info-item">
            <h6 class="rules-info-item-title">规则来源</h6>
            <span>{{policyBlocks._typeDisplay}}</span>
          </div>
          <!--<div class="rules-info-item">-->
          <!--<h6 class="rules-info-item-title">网络结构</h6>-->
          <!--<span>123生产线拓扑图</span>-->
          <!--</div>-->
        </div>
      </div>
    </div>
  </div>

  <br>

  <div class="bg-gray-80 spacing-small">
    <div class="row">
      <div class="col-xs-6">
        <h4 ng-if="policyBlocks.rules" class="modal-title"><i class="fa fa-list icon-left"></i>规则项</h4>
        <h4 ng-if="policyBlocks.signatures" class="modal-title"><i class="fa fa-list icon-left"></i>修补特征</h4>
      </div>
      <div class="col-xs-6 text-right">
      </div>
    </div>
  </div>

  <div class="table-scroll-wrapper-striped" ng-if="policyBlocks.signatures" class="margin-top-default">
    <table id="whitelist_policycontent_preview_window_table"
           class="table table-bordered table-hover icon-hidden table-preview-signature">
      <thead>
      <tr>
        <th>
          <span>优先级</span>
        </th>
        <th>
          <span>特征名称</span>
        </th>
        <th>
          <span>发布时间</span>
        </th>
        <th>
          <span>特征编号</span>
        </th>
        <th>
          <span>处理方式</span>
        </th>
      </tr>
      </thead>
      <tbody>
      <tr id="whitelist_policycontent_preview_window_table_row_{{$index}}" data-index="0"
          ng-repeat="signature in policyBlocks.signatures">
        <td>{{$index+1}}</td>
        <td>{{signature.signame}}</td>
        <td>{{signature.publishDate}}</td>
        <td>{{signature.sid}}</td>
        <td class="signature-btn-overflow">
          <div class="dropdown display-inline-block" dropdown>
            <button type="button" class="btn dropdown-toggle" dropdown-toggle>
              <i ng-if="signature.action =='REJECTBOTH'" class="fa fa-ban text-red"></i>
              <i ng-if="signature.action =='DROP'" class="fa fa-remove text-red"></i>
              <i ng-if="signature.action =='ALERT'" class="fa fa-exclamation-triangle text-yellow"></i>
              <i ng-if="signature.action =='ALLOW'" class="fa fa-check text-green"></i>
              {{signature.action |actionName}}
            </button>
            <ul class="dropdown-menu pull-left" role="menu" aria-labelledby="signature-drop-down">
              <li ng-click="changeAction(signature, 'REJECTBOTH')" role="presentation"><a class="dropdown-menu-item"
                                                                                    role="menuitem" tabindex="-1"
                                                                                    href="#"><i
                class="fa fa-ban text-red"></i> 阻断</a></li>
              <li ng-click="changeAction(signature, 'DROP')" role="presentation"><a class="dropdown-menu-item"
                                                                                    role="menuitem" tabindex="-1"
                                                                                    href="#"><i
                class="fa fa-remove text-red"></i> 丢弃</a></li>
              <li ng-click="changeAction(signature, 'ALERT')" role="presentation"><a class="dropdown-menu-item"
                                                                                     role="menuitem" tabindex="-1"
                                                                                     href="#"><i
                class="fa fa-exclamation-triangle text-yellow"></i> 警告</a></li>
              <li ng-click="changeAction(signature, 'ALLOW')" role="presentation"><a class="dropdown-menu-item"
                                                                                     role="menuitem" tabindex="-1"
                                                                                     href="#"><i
                class="fa fa-check text-green"></i> 允许</a></li>
            </ul>
          </div>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <div id="whitelist_policycontent_preview_window_custome_edit_area"
       class="custom-signature-edit-area signature-policy-content">
    <div class="custom-signature-create" ng-if="policyBlocks.rules ==0 && !editRules">
      <div ng-hide="editRules">
        <h4>请添加规则来完成编辑规则</h4>
        <br>
        <button class="btn btn-default btn-create-signature" ng-click="createRuleItem()">创建规则项<i
          class="fa fa-pencil fa-3x"></i></button>
      </div>
    </div>

    <div class="custom-signature-edit-rules" ng-if="editRules">
      <div>
        <button id="whitelist_policycontent_preview_window_custome_edit_confirmcreaterule_btn"
                class="btn btn-default pull-right" ng-if="!editRuleItem" ng-click="confirmCreateRule()"><i
          class="fa fa-check icon-left"></i>完成
        </button>
        <button id="whitelist_policycontent_preview_window_custome_edit_confirmruleedit_btn"
                class="btn btn-default pull-right" ng-if="editRuleItem" ng-click="confirmRuleEdit()"><i
          class="fa fa-check icon-left"></i>完成
        </button>
        <button id="whitelist_policycontent_preview_window_custome_edit_cancelruleedit_btn"
                class="btn btn-default pull-right" ng-click="cancelRuleEdit()"><i class="fa fa-times icon-left"></i>取消
        </button>
        <span class="custom-signature-padding">编辑规则项</span>
      </div>
      <div class="custom-signature-diagram">
        <ul id="diagram"></ul>
      </div>
    </div>

    <div ng-if="policyBlocks.rules && !editRules && policyBlocks.rules.length >0">

      <div ng-if="enabledEditRuleItem" setting-privilege privilege-name="RULE_WHITELIST" privilege-require="MIXED">
        <button id="rule-whiteList-editor_button_previewManage" class="btn btn-default" ng-click="createRuleItem()"
                ng-disabled="enableAction">新增规则
        </button>
        <button id="rule-whiteList-editor_button_previewUp" class="btn btn-default btn-sm" ng-click="moveUp()"
                ng-disabled="selectedRuleItems.length !=1 || enableAction"><i class="fa fa-chevron-up"></i></button>
        <button id="rule-whiteList-editor_button_previewDown" class="btn btn-default btn-sm" ng-click="moveDown()"
                ng-disabled="selectedRuleItems.length !=1 || enableAction"><i class="fa fa-chevron-down"></i></button>
        <button id="rule-whiteList-editor_button_previewDelete" class="btn btn-default btn-sm"
                ng-click="deleteRuleItems()" ng-disabled="selectedRuleItems.length == 0 || enableAction"><i
          class="fa fa-trash"></i></button>
      </div>

      <table id="whitelist_policycontent_preview_window_rule_table"
             class="table table-condensed table-th-right-border table-hover icon-hidden table-custom-preview-signature-2">
        <thead>
        <tr>
          <th class="th-count">
            <span>优先级</span>
          </th>
          <th ng-if="enabledEditRuleItem" class="th-checkbox">
            <span><input custom-checkbox id="rule-whiteList-editor_checkbox_previewCheckAll" type="checkbox"
                         ng-model="policyBlocks.selectAll" ng-change="selectAllRuleItem()"
                         ng-disabled="enableAction"></span>
          </th>
          <th class="th-protocol">
            <span>协议名称</span>
          </th>
          <th class="th-name">
            <span>规则项名称</span>
          </th>
          <th class="th-40">
            <span>操作码</span>
          </th>
          <th>
            <span>注释</span>
          </th>
          <th class="th-action">
            <span>处理方式</span>
          </th>
          <th class="th-action">
            <span>风险等级</span>
          </th>
          <th>
            <span>编辑</span>
          </th>
        </tr>
        </thead>
        <tbody>
        <tr id="whitelist_policycontent_preview_window_rule_table_row_{{$index}}" data-index="0"
            ng-repeat="rule in policyBlocks.rules">
          <td>{{$index+1}}</td>
          <td ng-if="enabledEditRuleItem">
            <span><input custom-checkbox id="rule-whiteList-editor_checkbox_previewCheck{{$index+1}}" type="checkbox"
                         ng-model="rule.checked" ng-change="selectRuleItem(rule)" ng-disabled="enableAction"></span>
          </td>
          <td>{{rule.fields[0].value==='modbus-tcp'?'Modbus-TCP':rule.fields[0].value}}</td>
          <td>{{rule.ruleName}}</td>
          <td>
            <div ng-repeat="field in rule.fields">
              <span ng-if="$index >0">{{field.name}}:
                <span ng-if="enabledEditRuleItem" class="pull-right"></span>
                {{field.value}}
              </span>
            </div>
          </td>
          <td>
            <div class="percent-80-width">
              {{rule._fields}}
            </div>
          </td>
          <td class="signature-btn-overflow">
            <div class="dropdown display-inline-block" dropdown>
              <div ng-show="deployedPolicy">
                <i ng-if="rule.action =='REJECTBOTH'" class="fa fa-ban text-red"></i>
                <i ng-if="rule.action =='DROP'" class="fa fa-remove text-red"></i>
                <i ng-if="rule.action =='ALERT'" class="fa fa-exclamation-triangle text-yellow"></i>
                <i ng-if="rule.action =='ALLOW'" class="fa fa-check text-green"></i>
                {{rule.action |actionName}}
              </div>
              <button id="rule-whiteList-editor_button_previewDropDown{{$index+1}}" type="button"
                      class="btn dropdown-toggle" ng-if="!deployedPolicy" dropdown-toggle
                      setting-privilege privilege-name="RULE_WHITELIST" privilege-require="VIEW" privilege-handle="disabled">
                <i ng-if="rule.action =='REJECTBOTH'" class="fa fa-ban text-red"></i>
                <i ng-if="rule.action =='DROP'" class="fa fa-remove text-red"></i>
                <i ng-if="rule.action =='ALERT'" class="fa fa-exclamation-triangle text-yellow"></i>
                <i ng-if="rule.action =='ALLOW'" class="fa fa-check text-green"></i>
                {{rule.action |actionName}}
              </button>
              <ul class="dropdown-menu pull-left" role="menu" aria-labelledby="signature-drop-down">
                <li id="rule-whiteList-editor_li_previewReject{{$index+1}}" ng-click="changeAction(rule, 'REJECTBOTH')"
                    role="presentation"><a class="dropdown-menu-item" role="menuitem" tabindex="-1" href="#"><i
                  class="fa fa-ban text-red"></i> 阻断</a></li>
                <li id="rule-whiteList-editor_li_previewDeny{{$index+1}}" ng-click="changeAction(rule, 'DROP')"
                    role="presentation"><a class="dropdown-menu-item" role="menuitem" tabindex="-1" href="#"><i
                  class="fa fa-remove text-red"></i> 丢弃</a></li>
                <li id="rule-whiteList-editor_li_previewAlert{{$index+1}}" ng-click="changeAction(rule, 'ALERT')"
                    role="presentation"><a class="dropdown-menu-item" role="menuitem" tabindex="-1" href="#"><i
                  class="fa fa-exclamation-triangle text-yellow"></i> 警告</a></li>
                <li id="rule-whiteList-editor_li_previewAllow{{$index+1}}" ng-click="changeAction(rule, 'ALLOW')"
                    role="presentation"><a class="dropdown-menu-item" role="menuitem" tabindex="-1" href="#"><i
                  class="fa fa-check text-green"></i> 允许</a></li>
              </ul>
            </div>
          </td>
          <td class="signature-btn-overflow">
            <div class="dropdown display-inline-block" dropdown>
              <div ng-show="deployedPolicy">
                {{rule.riskLevel | riskLevel}}
              </div>
              <button id="rule-whiteList-editor_button_riskLevel_previewDropDown{{$index+1}}" type="button"
                      class="btn dropdown-toggle" ng-if="!deployedPolicy" dropdown-toggle
                      setting-privilege privilege-name="RULE_WHITELIST" privilege-require="VIEW" privilege-handle="disabled">
                {{rule.riskLevel | riskLevel}}
              </button>
              <ul class="dropdown-menu pull-left" role="menu" aria-labelledby="signature-drop-down">
                <li id="rule-whiteList-editor_li_riskLevelLow{{$index+1}}" ng-click="changeRiskLevel(rule, 'LOW')"
                    role="presentation"><a class="dropdown-menu-item" role="menuitem" tabindex="-1" href="#">低</a></li>
                <li id="rule-whiteList-editor_li_riskLevelMedium{{$index+1}}" ng-click="changeRiskLevel(rule, 'MEDIUM')"
                    role="presentation"><a class="dropdown-menu-item" role="menuitem" tabindex="-1" href="#">中</a></li>
                <li id="rule-whiteList-editor_li_riskLevelHigh{{$index+1}}" ng-click="changeRiskLevel(rule, 'HIGH')"
                    role="presentation"><a class="dropdown-menu-item" role="menuitem" tabindex="-1" href="#">高</a></li>
              </ul>
            </div>
          </td>
          <td>
            <button id="rule-whiteList-editor_button_previewEdit{{$index+1}}" class="btn btn-default btn-sm pull-right"
                    ng-if="enableEdit" ng-disabled="enableAction" ng-click="modifyRuleItem($index,rule)"
                    setting-privilege privilege-name="RULE_WHITELIST" privilege-require="MIXED"><i
              class="fa fa-pencil"></i></button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
    <div id="policy_content_table_pagination" class="text-center">
      <pagination ng-model="rulePagination.currentPage"
                  class="pagination-sm"
                  boundary-links="true"
                  total-items="rulePagination.totalNum"
                  items-per-page="rulePagination.numPerPage"
                  max-size="5"
                  num-pages="rulePagination.numPages"
                  previous-text="&lsaquo;"
                  next-text="&rsaquo;"
                  first-text="&laquo;"
                  last-text="&raquo;"
                  ng-change="pageChanged()"
      ></pagination>

    </div>
  </div>

  <!--
  <div class="modal-footer">
	<button class="btn btn-default" ng-click="cancel()">Cancel</button>
	<button class="btn btn-primary" ng-click="ok()">关闭</button>
  </div>
  -->
</div>
